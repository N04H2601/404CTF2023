# Oracle cass√©

**Cat√©gorie** : Introduction | **Points** : 100 | **Solves** : 597

## Description

*Communiqu√© de la direction du 404CTF*

*Nous souhaitons prendre la parole pour vous dire que nous avons compris vos plaintes concernant les oracles de l'√©dition pr√©c√©dente. Nous comprenons que ces derniers ont √©t√© jug√©s injustes et trop difficiles √† deviner, et c'est pourquoi nous avions d√©cid√© de les retirer. C'est pourquoi nous avons d√©cid√© de refaire un nouvel oracle, avec les toutes derni√®res technologies d'optimisation √† notre disposition. Afin de nous excuser pour la g√®ne occasionn√©e, nous offrons aux 1000 premiers arriv√©s un cadeau √† r√©cup√©rer directement dans l'oracle. Par souci de transparence, nous vous fournirons cette fois-ci le code de fonctionnement exact de cet oracle.*

*Nous vous prions d'agr√©er, Madame, Monsieur, l'expression de nos salutations distingu√©es.*
*Colette, directrice du Matin et du 404CTF*


## Solution

D'ap√®rs le script python fourni dans l'√©nonc√©, nous sommes face √† un oracle de d√©chiffrement RSA. Ce-dernier utilise une impl√©mentation du Chinese Remainder Theorem (CRT) pour optimiser le d√©chiffrement (qui permet de le r√©aliser presque 4 fois plus vite). Cependant, en lisant un [papier](https://crypto.stanford.edu/~dabo/papers/RSA-survey.pdf) parlant de diff√©rentes attaques sur le RSA, je suis tomb√© sur une attaque concernant le CRT.

En effet, cette attaque est r√©alisable lorsque d'un des param√®tres du CRT a √©t√© mal calcul√© (pour diverses raisons comme un bug, une perturbation magn√©tique lors du chiffrement, etc.). Cette attaque fait partie de la section des d√©faillances al√©atoires. J'ai donc impl√©ment√© la solution propos√©e par le [papier](https://crypto.stanford.edu/~dabo/papers/RSA-survey.pdf) qui consiste √† calculer le pgcd suivant : ``gcd(N, M_mal_calcul√©_par_l'oracle ^ e - C_envoy√©_√†_l'oracle)``.

Par exemple :

```
C = 13715983003666222361724323515089162544345909772599065756969898013040554100468646846091651108701632365097731525141520469431582174078347708109969982062212603001118551226139763017250149141076548382191047910422961768706454937964254506642466289390407214330122053739402362469435309321680137547408615538727193076067250601989672418702855069868105921005502231827577023073068141711828891100543785642876597077989844985132607299825800992834724839006030698547975185537041838695627548953222853509966259708115226543210558547147065207013060176315810150448387180802140364650250973307310661371307636401852170579661761096036655167456562

N = 17687933842071746475159061396101909403461458209001728574744732239091940798436715162261572481953766334299636886550673516341090379955821840214772956720649595123421504121620501992829348522791162973670504484195978800275728814375822983209064224135566092822633548032766245296514452695239333952745211813162413910684809587050413117179613603843327772227547821345169373948348073056999837519061198858660079024519223236932628987474775030430434930875804144593357622236824644089366149607270227841907314799677956045255968135264539250851845164662838375042871730185473355696190528309386261477365926467553692884507590151932535903404959

e = 65537
```

Je d√©cide d'envoyer par exemple ``10`` √† l'oracle et je re√ßois :

```
M_10 = 1549607769305359674395694045943910463208102949751360677953121070034820632688361239815497790134011900736705216887316697271742318566321915825120362630239177533291810852578922440217740484136097640215625857553407587138891628047156834998248322729204600251851112064836661701713380785398199087442399962984517318338828635011613063623134152611050489138348922595176387011850977869958844772735627126296567073188629747516804438203618682948865332101179340256967491016721857101868358029003654869070921056219449302505295018877276321063854084037279490133796283888793382507196009983003361728137161825219613471286231185739626231903009
```

Il suffit de renvoyer ce r√©sultat √† l'oracle pour se rendre compte que l'on ne retrouve pas 10.

On calcule donc notre pgcd (qui permet de d√©terminer un facteur de N) :

```py
from math import gcd

n = 17687933842071746475159061396101909403461458209001728574744732239091940798436715162261572481953766334299636886550673516341090379955821840214772956720649595123421504121620501992829348522791162973670504484195978800275728814375822983209064224135566092822633548032766245296514452695239333952745211813162413910684809587050413117179613603843327772227547821345169373948348073056999837519061198858660079024519223236932628987474775030430434930875804144593357622236824644089366149607270227841907314799677956045255968135264539250851845164662838375042871730185473355696190528309386261477365926467553692884507590151932535903404959
e = 65537
m_10 = 1549607769305359674395694045943910463208102949751360677953121070034820632688361239815497790134011900736705216887316697271742318566321915825120362630239177533291810852578922440217740484136097640215625857553407587138891628047156834998248322729204600251851112064836661701713380785398199087442399962984517318338828635011613063623134152611050489138348922595176387011850977869958844772735627126296567073188629747516804438203618682948865332101179340256967491016721857101868358029003654869070921056219449302505295018877276321063854084037279490133796283888793382507196009983003361728137161825219613471286231185739626231903009


print(gcd(n, pow(m_10, e, n) - 10))
# Output: 126201398751888100159434186321762278203199440355009847538167424401257207961817478825988569670802124131816975212449246962274697200347497176199003066659969884502150284856278390292556072268851696390295087877075131847755893431888541039741657995405755616945118784135632035726665016429693052931862180711433201887969
```

On a donc identifi√© un facteur non trivial de N. Il ne reste plus qu'√† d√©chiffrer le cipher donn√© lors de la connexion netcat gr√¢ce √† [dCode](https://www.dcode.fr/chiffre-rsa) et on obtient le flag.

## Flag

<details>
<summary>üö©</summary>

```
404CTF{Un_0r4cl3_vr41m3n7_c4553_c3773_f015}
```